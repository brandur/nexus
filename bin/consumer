#!/usr/bin/env ruby

require "bundler/setup"
Bundler.require

require_relative "../lib/nexus"

$global_context = Nexus::Context.new

def env!(k)
  ENV[k] || raise("missing_environment=#{k}")
end

def source(name, &block)
  $global_context.source(name, &block)
end

# primary instruction set
require_relative "../app"

DB = Sequel.connect(env!("DATABASE_URL"))

Nexus::Consumer.new($global_context).run
